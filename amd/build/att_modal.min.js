define("block_face_recognition_student_attendance/att_modal",["exports","jquery","core/modal_factory","core/ajax"],(function(_exports,_jquery,_modal_factory,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_modal_factory=_interopRequireDefault(_modal_factory),_ajax=_interopRequireDefault(_ajax);_exports.init=function(studentid){(0,_jquery.default)(".action-modal").on("click",(function(){var st_img_url="",course_id=(0,_jquery.default)(this).attr("id"),request={methodname:"block_face_recognition_student_attendance_image_api",args:{courseid:course_id,studentid:studentid}};_ajax.default.call([request])[0].done((function(value){st_img_url=value.image_url})).fail(Notification.exception),_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:"Turn on webcam",body:'\n      <p>webcam will be turned on to take video and image input for your attendance</p>\n      <button id=\'start-webcam\' class="btn btn-primary">Start Webcam</button>\n      <button id=\'stop-webcam\' class="btn btn-secondary">Cancel</button>\n      <video id="webcam" autoplay playsinline width="300" height="225"></video>\n      <img id="st-image" style="display: none;"/>\n      <canvas id="canvas" class="d-none"></canvas>'}).then((function(modal){modal.setSaveButtonText("Start Webcam"),modal.show(),(0,_jquery.default)(".modal-footer").hide();document.getElementById("webcam");var canvasElement=document.getElementById("canvas"),studentimg=document.getElementById("st-image");studentimg.src=st_img_url;var st_img="";(0,_jquery.default)("#start-webcam").on("click",(function(){setInterval((function(){if(!st_img){var context=canvasElement.getContext("2d");context.clearRect(0,0,studentimg.width,studentimg.height),context.drawImage(studentimg,0,0,studentimg.width,studentimg.height),st_img=canvasElement.toDataURL("image/png")}var image=webcam.snap(),request={methodname:"block_face_recognition_student_attendance_face_recog_api",args:{studentimg:st_img,webcampicture:image}};_ajax.default.call([request])[0].done((function(value){if(value.confidence>=.7){var _request={methodname:"block_face_recognition_student_attendance_update_db",args:{courseid:course_id,studentid:studentid}};_ajax.default.call([_request])[0].done((function(){window.location.href=(0,_jquery.default)(location).attr("href")})).fail(Notification.exception)}})).fail((function(err){window.console.log(err)}))}),2e3)})),(0,_jquery.default)("#stop-webcam").on("click",(function(){webcam.stop(),window.location.href=(0,_jquery.default)(location).attr("href")}))}))}))}}));

//# sourceMappingURL=att_modal.min.js.map