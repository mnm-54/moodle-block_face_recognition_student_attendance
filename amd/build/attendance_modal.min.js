define ("block_face_recognition_student_attendance/attendance_modal",["exports","jquery","core/modal_factory","./webcam","core/ajax"],function(a,b,c,d,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=f(b);c=f(c);d=f(d);e=f(e);function f(a){return a&&a.__esModule?a:{default:a}}var g=function(a,f,g){(0,b.default)(".action-modal").on("click",function(){var h="",i=(0,b.default)(this).attr("id");e.default.call([{methodname:"block_face_recognition_student_attendance_image_api",args:{courseid:i,studentid:a}}])[0].done(function(a){h=a.image_url}).fail(Notification.exception);c.default.create({type:c.default.types.SAVE_CANCEL,title:"Turn on webcam",body:"\n      <p>webcam will be turned on to take video and image input for your attendance</p>\n      <button id='start-webcam' class=\"btn btn-primary\">Start Webcam</button>\n      <button id='stop-webcam' class=\"btn btn-secondary\">Cancel</button>\n      <video id=\"webcam\" autoplay playsinline width=\"300\" height=\"225\"></video>\n      <canvas id=\"canvas\" class=\"d-none\"></canvas>\n      <img id=\"st-image\" style=\"display: none;\"/>\n      <button id=\"submit-attendance\" style=\"display:none;\" class=\"btn btn-primary\">Submit attendance</button>\n      <button id=\"try-again\" style=\"display:none;\" class=\"btn btn-primary\">Try again</button>\n      <div id=\"message\"></div>"}).then(function(c){c.setSaveButtonText("Start Webcam");c.show();(0,b.default)(".modal-footer").hide();var u=document.getElementById("webcam"),v=document.getElementById("canvas"),w=document.getElementById("st-image");w.src=h;var x="",y=new d.default(u,"user",v);function j(a){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a,0,0);return b.toDataURL("image/png")}function k(){document.getElementById("submit-attendance").style.display="block"}function l(){document.getElementById("submit-attendance").style.display="none"}function m(){document.getElementById("try-again").style.display="block"}function n(){document.getElementById("try-again").style.display="none"}function o(){var a=document.getElementById("message");while(a.hasChildNodes()){a.removeChild(a.firstChild)}}function p(){l();r(f,1)}function q(){l();m();r(g,0)}function r(a,b){var c=document.createElement("span");c.textContent=a+".";c.setAttribute("class",b?"text-success":"text-danger");document.getElementById("message").appendChild(c)}function s(){e.default.call([{methodname:"block_face_recognition_student_attendance_update_db",args:{courseid:i,studentid:a}}])[0].done(function(){window.location.href=(0,b.default)(location).attr("href")}).fail(Notification.exception)}function t(a,b){e.default.call([{methodname:"block_face_recognition_student_attendance_face_recog_api",args:{studentimg:a,webcampicture:b}}])[0].done(function(a){var b=a.confidence;console.log(a);if(.7<=b){console.log("Success");p();s()}else{q()}}).fail(function(a){window.console.log(a)})}(0,b.default)("#start-webcam").on("click",function(){y.start().then(function(){k();(0,b.default)("#submit-attendance").on("click",function(){o();if(!x){x=j(w)}var a=y.snap();t(x,a)});(0,b.default)("#try-again").on("click",function(){o();n();document.getElementById("submit-attendance").click()})}).catch(function(a){window.console.log(a)})});(0,b.default)("#stop-webcam").on("click",function(){y.stop();window.location.href=(0,b.default)(location).attr("href")})})})};a.init=g});
//# sourceMappingURL=attendance_modal.min.js.map
