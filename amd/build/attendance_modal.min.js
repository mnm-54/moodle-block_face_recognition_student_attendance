define ("block_face_recognition_student_attendance/attendance_modal",["exports","jquery","core/modal_factory","./webcam","core/ajax"],function(a,b,c,d,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=f(b);c=f(c);d=f(d);e=f(e);function f(a){return a&&a.__esModule?a:{default:a}}var g=function(a){(0,b.default)(".action-modal").on("click",function(){var f="",g=(0,b.default)(this).attr("id");e.default.call([{methodname:"block_face_recognition_student_attendance_image_api",args:{courseid:g,studentid:a}}])[0].done(function(a){f=a.image_url}).fail(Notification.exception);c.default.create({type:c.default.types.SAVE_CANCEL,title:"Turn on webcam",body:"\n      <p>webcam will be turned on to take video and image input for your attendance</p>\n      <button id='start-webcam' class=\"btn btn-primary\">Start Webcam</button>\n      <button id='stop-webcam' class=\"btn btn-secondary\">Cancel</button>\n      <video id=\"webcam\" autoplay playsinline width=\"300\" height=\"225\"></video>\n      <img id=\"st-image\" style=\"display: none;\"/>\n      <canvas id=\"canvas\" class=\"d-none\"></canvas>"}).then(function(c){c.setSaveButtonText("Start Webcam");c.show();(0,b.default)(".modal-footer").hide();var h=document.getElementById("webcam"),i=document.getElementById("canvas"),j=document.getElementById("st-image");j.src=f;var k="",l=new d.default(h,"user",i);(0,b.default)("#start-webcam").on("click",function(){l.start().then(function(){window.console.log("webcam started")}).catch(function(a){window.console.log(a)});setInterval(function(){if(!k){var h=i.getContext("2d");h.clearRect(0,0,j.width,j.height);h.drawImage(j,0,0,j.width,j.height);k=i.toDataURL("image/png")}var c=l.snap(),d={studentimg:f,webcampicture:c};e.default.call([{methodname:"block_face_recognition_student_attendance_face_recog_api",args:d}])[0].done(function(c){var d=c.confidence;if(.7<=d){e.default.call([{methodname:"block_face_recognition_student_attendance_update_db",args:{courseid:g,studentid:a}}])[0].done(function(){window.location.href=(0,b.default)(location).attr("href")}).fail(Notification.exception)}}).fail(function(a){window.console.log(a)})},2e3)});(0,b.default)("#stop-webcam").on("click",function(){l.stop();window.location.href=(0,b.default)(location).attr("href")})})})};a.init=g});
//# sourceMappingURL=attendance_modal.min.js.map
