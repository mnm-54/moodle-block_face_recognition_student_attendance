define ("block_face_recognition_student_attendance/attendance_modal",["exports","jquery","core/modal_factory","./webcam","core/ajax"],function(a,b,c,d,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=f(b);c=f(c);d=f(d);e=f(e);function f(a){return a&&a.__esModule?a:{default:a}}var g=function(a,f,g){(0,b.default)(".action-modal").on("click",function(){var h="",i=(0,b.default)(this).attr("id");e.default.call([{methodname:"block_face_recognition_student_attendance_image_api",args:{courseid:i,studentid:a}}])[0].done(function(a){h=a.image_url;j()}).fail(Notification.exception);var j=function(){c.default.create({type:c.default.types.SAVE_CANCEL,title:"Turn on webcam",body:"\n        <p>webcam will be turned on to take video and image input for your attendance</p>\n        <button id='start-webcam' class=\"btn btn-primary\">Start Webcam</button>\n        <button id='stop-webcam' class=\"btn btn-secondary\">Cancel</button>\n        <video id=\"webcam\" autoplay playsinline width=\"300\" height=\"225\"></video>\n        <canvas id=\"canvas\" class=\"d-none\"></canvas>\n        <img id=\"st-image\" style=\"display: none;\"/>\n        <button id=\"submit-attendance\" style=\"display:none;\" class=\"btn btn-primary\">Submit attendance</button>\n        <button id=\"try-again\" style=\"display:none;\" class=\"btn btn-primary\">Try again</button>\n        <div id=\"message\"></div>"}).then(function(c){c.setSaveButtonText("Start Webcam");c.show();(0,b.default)(".modal-footer").hide();var j=document.getElementById("webcam"),k=document.getElementById("canvas"),l=document.getElementById("st-image");l.src=h;var m="",n=new d.default(j,"user",k);(0,b.default)(".close").on("click",function(){n.stop();window.location.href=(0,b.default)(location).attr("href")});var o=function(a){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a,0,0);return b.toDataURL("image/png")},p=function(){document.getElementById("submit-attendance").style.display="block"},q=function(){document.getElementById("submit-attendance").style.display="none"},r=function(){document.getElementById("try-again").style.display="block"},s=function(){document.getElementById("try-again").style.display="none"},t=function(){var a=document.getElementById("message");while(a.hasChildNodes()){a.removeChild(a.firstChild)}},u=function(){q();w(f,1)},v=function(){q();r();w(g,0)},w=function(a,b){var c=document.createElement("span");c.textContent=a+".";c.setAttribute("class",b?"text-success":"text-danger");document.getElementById("message").appendChild(c)},x=function(){e.default.call([{methodname:"block_face_recognition_student_attendance_update_db",args:{courseid:i,studentid:a}}])[0].done(function(){window.location.href=(0,b.default)(location).attr("href")}).fail(Notification.exception)},y=function(a,c){e.default.call([{methodname:"block_face_recognition_student_attendance_face_recog_api",args:{studentimg:a,webcampicture:c}}])[0].done(function(a){var c=a.confidence;window.console.log(a);if(.6<=c){window.console.log("Success");u();x();setTimeout(function(){window.location.href=(0,b.default)(location).attr("href")},1e3)}else{v()}}).fail(function(a){window.console.log(a)})};(0,b.default)("#start-webcam").on("click",function(){n.start().then(function(){p();(0,b.default)("#submit-attendance").on("click",function(){t();if(!m){m=o(l)}var a=n.snap();y(m,a)});(0,b.default)("#try-again").on("click",function(){t();s();document.getElementById("submit-attendance").click()})}).catch(function(a){window.console.log(a)})});(0,b.default)("#stop-webcam").on("click",function(){n.stop();window.location.href=(0,b.default)(location).attr("href")})})}})};a.init=g});
//# sourceMappingURL=attendance_modal.min.js.map
