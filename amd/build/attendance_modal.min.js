define ("block_face_recognition_student_attendance/attendance_modal",["exports","jquery","core/modal_factory","core/notification","./webcam","core/ajax"],function(a,b,c,d,e,f){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=g(b);c=g(c);d=g(d);e=g(e);f=g(f);function g(a){return a&&a.__esModule?a:{default:a}}var h=function(a,g,h){(0,b.default)(".action-modal").on("click",function(){var i="",j=(0,b.default)(this).attr("id");f.default.call([{methodname:"block_face_recognition_student_attendance_image_api",args:{courseid:j,studentid:a}}])[0].done(function(a){i=a.image_url;k()}).fail(d.default.exception);var k=function(){c.default.create({type:c.default.types.SAVE_CANCEL,title:"Turn on WEBCAM",body:"\n        <div>\n        <p>WEBCAM will be turned on to take video and image input for your attendance.\n        <i class=\"icon fa fa-exclamation-circle text-muted fa-fw \" \n            title=\"If facing any issue with webcam, refresh the site and try again\" role=\"img\" \n            aria-label=\"If facing any issue with webcam, refresh the site and try again\">\n        </i>\n        </p>\n        </div>\n        <video id=\"webcam\" autoplay playsinline width=\"300\" height=\"225\" style=\"display:none;margin:10px 60px\"></video>\n        <canvas id=\"canvas\" class=\"d-none\" style=\"display:none;\"></canvas>\n        <img id=\"st-image\" style=\"display: none;\"/>\n        <div style=\"display: flex; flex-wrap: wrap; align-items: center; justify-content: flex-end; padding: 0.75rem;\">\n        <button id='start-webcam' class=\"btn btn-primary\" >Start Webcam</button>\n        <button id=\"submit-attendance\" style=\"display:none;\" class=\"btn btn-primary\" >Submit attendance</button>\n        <button id=\"try-again\" style=\"display:none;\" class=\"btn btn-primary\" >Try again</button>\n        <button id='stop-webcam' class=\"btn btn-secondary\" style=\"margin-left:5px;\">Cancel</button>\n        </div>\n        <div id=\"message\"></div>"}).then(function(c){c.show();(0,b.default)(".modal-footer").hide();var k=document.getElementById("webcam"),l=document.getElementById("canvas"),m=document.getElementById("st-image");m.src=i;var n="",o=new e.default(k,"user",l);(0,b.default)(".close").on("click",function(){o.stop();window.location.href=(0,b.default)(location).attr("href")});var p=function(a){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a,0,0);return b.toDataURL("image/png")},q=function(){document.getElementById("submit-attendance").style.display="block"},r=function(){document.getElementById("submit-attendance").style.display="none"},s=function(){document.getElementById("try-again").style.display="block"},t=function(){document.getElementById("try-again").style.display="none"},u=function(){var a=document.getElementById("message");while(a.hasChildNodes()){a.removeChild(a.firstChild)}},v=function(){r();x(g,1)},w=function(){r();s();x(h,0)},x=function(a,b){var c=document.createElement("span");c.textContent=a+".";c.setAttribute("class",b?"text-success":"text-danger");document.getElementById("message").appendChild(c)},y=function(){f.default.call([{methodname:"block_face_recognition_student_attendance_update_db",args:{courseid:j,studentid:a}}])[0].done(function(){}).fail(d.default.exception)},z=function(a,c){f.default.call([{methodname:"block_face_recognition_student_attendance_face_recog_api",args:{studentimg:a,webcampicture:c}}])[0].done(function(a){var c=a.confidence;window.console.log(a);if(.6<=c){window.console.log("Success");v();y();setTimeout(function(){window.location.href=(0,b.default)(location).attr("href")},2e3);d.default.alert("Attendance Status","Attendance Submitted Successfully","Continue")}else{w()}}).fail(function(a){window.console.log(a)})};(0,b.default)("#start-webcam").on("click",function(){k.style.display="block";l.style.display="block";(0,b.default)("#start-webcam").hide();o.start().then(function(){q();(0,b.default)("#submit-attendance").on("click",function(){u();if(!n){n=p(m)}var a=o.snap();z(n,a)});(0,b.default)("#try-again").on("click",function(){u();t();document.getElementById("submit-attendance").click()})}).catch(function(a){window.console.log(a)})});(0,b.default)("#stop-webcam").on("click",function(){o.stop();window.location.href=(0,b.default)(location).attr("href")})})}})};a.init=h});
//# sourceMappingURL=attendance_modal.min.js.map
