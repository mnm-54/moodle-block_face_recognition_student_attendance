define ("block_face_recognition_student_attendance/attendance_modal",["exports","jquery","core/modal_factory","core/notification","./webcam","core/ajax"],function(a,b,c,d,e,f){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=g(b);c=g(c);d=g(d);e=g(e);f=g(f);function g(a){return a&&a.__esModule?a:{default:a}}var h=function(a,g,h){(0,b.default)(".action-modal").on("click",function(){var i="",j="",k=(0,b.default)(this).attr("id");f.default.call([{methodname:"block_face_recognition_student_attendance_image_api",args:{courseid:k,studentid:a}}])[0].done(function(a){i=a.image_url;j=a.course_name;l()}).fail(d.default.exception);var l=function(){c.default.create({type:c.default.types.SAVE_CANCEL,title:"Turn on webcam",body:"\n        <div>\n        <p>Webcam will be turned on to take video and image input for your attendance.\n        <i class=\"icon fa fa-exclamation-circle text-muted fa-fw \" \n            title=\"If facing any issue with webcam, refresh the site and try again\" role=\"img\" \n            aria-label=\"If facing any issue with webcam, refresh the site and try again\">\n        </i>\n        </p>\n        </div>\n        <video id=\"webcam\" autoplay playsinline width=\"300\" height=\"225\" style=\"display:none;margin:auto\"></video>\n        <canvas id=\"canvas\" class=\"d-none\" style=\"display:none;\"></canvas>\n        <img id=\"st-image\" style=\"display: none;\"/>\n        <div style=\"display: flex; flex-wrap: wrap; align-items: center; justify-content: center; padding: 0.75rem;\">\n        \n          <button id='start-webcam' class=\"btn btn-primary\" >Start Webcam</button>\n          <button id=\"submit-attendance\" style=\"display:none;\" class=\"btn btn-primary\" >Submit attendance</button>\n          <button id=\"try-again\" style=\"display:none;\" class=\"btn btn-primary\" >Try again</button>\n          <button id='stop-webcam' class=\"btn btn-secondary\" style=\"margin-left:5px;\">Cancel</button>\n        \n        </div>\n        <div id=\"message\"></div>"}).then(function(c){c.show();(0,b.default)(".modal-footer").hide();var l=document.getElementById("webcam"),m=document.getElementById("canvas"),n=document.getElementById("st-image");n.src=i;var o="",p=new e.default(l,"user",m);(0,b.default)(".close").on("click",function(){p.stop();window.location.href=(0,b.default)(location).attr("href")});var q=function(a){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a,0,0);return b.toDataURL("image/png")},r=function(){document.getElementById("submit-attendance").style.display="block"},s=function(){document.getElementById("submit-attendance").style.display="none"},t=function(){document.getElementById("try-again").style.display="block"},u=function(){document.getElementById("try-again").style.display="none"},v=function(){var a=document.getElementById("message");while(a.hasChildNodes()){a.removeChild(a.firstChild)}},w=function(){s();y(g,1)},x=function(){s();t();y(h,0)},y=function(a,b){var c=document.createElement("span");c.textContent=a+".";c.setAttribute("class",b?"text-success":"text-danger");document.getElementById("message").appendChild(c)},z=function(){f.default.call([{methodname:"block_face_recognition_student_attendance_update_db",args:{courseid:k,studentid:a}}])[0].done(function(){}).fail(d.default.exception)},A=function(a,c){f.default.call([{methodname:"block_face_recognition_student_attendance_face_recog_api",args:{studentimg:a,webcampicture:c}}])[0].done(function(a){var c=a.confidence;window.console.log(a);if(.6<=c){p.stop();w();z();if(confirm("Course: ".concat(j,", Attendance: Completed"))){window.location.href=(0,b.default)(location).attr("href")}else{window.location.href=(0,b.default)(location).attr("href")}}else{x()}}).fail(function(a){window.console.log(a)})};(0,b.default)("#start-webcam").on("click",function(){l.style.display="block";m.style.display="block";(0,b.default)("#start-webcam").hide();p.start().then(function(){r();(0,b.default)("#submit-attendance").on("click",function(){v();if(!o){o=q(n)}var a=p.snap();A(o,a)});(0,b.default)("#try-again").on("click",function(){v();u();document.getElementById("submit-attendance").click()})}).catch(function(a){window.console.log(a)})});(0,b.default)("#stop-webcam").on("click",function(){p.stop();window.location.href=(0,b.default)(location).attr("href")})})}})};a.init=h});
//# sourceMappingURL=attendance_modal.min.js.map
