{"version":3,"file":"att_modal.min.js","sources":["../src/att_modal.js"],"sourcesContent":["import $ from \"jquery\";\nimport ModalFactory from \"core/modal_factory\";\n// import Webcam from \"./webcam\";\nimport Ajax from \"core/ajax\";\n\nexport const init = (studentid) => {\n  $(\".action-modal\").on(\"click\", function () {\n    let st_img_url = \"\";\n    let course_id = $(this).attr(\"id\");\n\n    // ajax call\n    let wsfunction = \"block_face_recognition_student_attendance_image_api\";\n    let params = {\n      courseid: course_id,\n      studentid: studentid,\n    };\n    let request = {\n      methodname: wsfunction,\n      args: params,\n    };\n\n    Ajax.call([request])[0]\n      .done(function (value) {\n        st_img_url = value[\"image_url\"];\n      })\n      .fail(Notification.exception);\n    // end of ajax call\n\n    ModalFactory.create({\n      type: ModalFactory.types.SAVE_CANCEL,\n      title: \"Turn on webcam\",\n      body: `\n      <p>webcam will be turned on to take video and image input for your attendance</p>\n      <button id='start-webcam' class=\"btn btn-primary\">Start Webcam</button>\n      <button id='stop-webcam' class=\"btn btn-secondary\">Cancel</button>\n      <video id=\"webcam\" autoplay playsinline width=\"300\" height=\"225\"></video>\n      <img id=\"st-image\" style=\"display: none;\"/>\n      <canvas id=\"canvas\" class=\"d-none\"></canvas>`,\n    }).then(function (modal) {\n      modal.setSaveButtonText(\"Start Webcam\");\n\n      modal.show();\n      $(\".modal-footer\").hide();\n\n      const webcamElement = document.getElementById(\"webcam\");\n      const canvasElement = document.getElementById(\"canvas\");\n      let studentimg = document.getElementById(\"st-image\");\n      studentimg.src = st_img_url;\n      let st_img = \"\";\n\n      //let webcam = new Webcam(webcamElement, \"user\", canvasElement);\n\n      $(\"#start-webcam\").on(\"click\", function () {\n        // webcam\n        //   .start()\n        //   .then((result) => {\n        //     window.console.log(\"webcam started\");\n        //   })\n        //   .catch((err) => {\n        //     window.console.log(err);\n        //   });\n\n        setInterval(() => {\n          // getting image\n          if (!st_img) {\n            let context = canvasElement.getContext(\"2d\");\n            context.clearRect(0, 0, studentimg.width, studentimg.height);\n            context.drawImage(\n              studentimg,\n              0,\n              0,\n              studentimg.width,\n              studentimg.height\n            );\n            st_img = canvasElement.toDataURL(\"image/png\");\n          }\n\n          var image = webcam.snap();\n\n          // ajax call\n          let wsfunction =\n            \"block_face_recognition_student_attendance_face_recog_api\";\n          let params = {\n            studentimg: st_img,\n            webcampicture: image,\n          };\n          let request = {\n            methodname: wsfunction,\n            args: params,\n          };\n\n          Ajax.call([request])[0]\n            .done(function (value) {\n              let result = value[\"confidence\"];\n\n              if (result >= 0.7) {\n                // ajax call\n                let wsfunction =\n                  \"block_face_recognition_student_attendance_update_db\";\n                let params = {\n                  courseid: course_id,\n                  studentid: studentid,\n                };\n                let request = {\n                  methodname: wsfunction,\n                  args: params,\n                };\n\n                Ajax.call([request])[0]\n                  .done(function () {\n                    window.location.href = $(location).attr(\"href\");\n                  })\n                  .fail(Notification.exception);\n                // end of ajax call\n              }\n            })\n            .fail(function (err) {\n              window.console.log(err);\n            });\n          // end of ajax call\n        }, 2000);\n      });\n      $(\"#stop-webcam\").on(\"click\", function () {\n        webcam.stop();\n        window.location.href = $(location).attr(\"href\");\n      });\n    });\n  });\n};\n"],"names":["studentid","on","st_img_url","course_id","this","attr","request","methodname","args","courseid","call","done","value","fail","Notification","exception","create","type","ModalFactory","types","SAVE_CANCEL","title","body","then","modal","setSaveButtonText","show","hide","document","getElementById","canvasElement","studentimg","src","st_img","setInterval","context","getContext","clearRect","width","height","drawImage","toDataURL","image","webcam","snap","webcampicture","window","location","href","err","console","log","stop"],"mappings":"mdAKoB,SAACA,+BACjB,iBAAiBC,GAAG,SAAS,eACzBC,WAAa,GACbC,WAAY,mBAAEC,MAAMC,KAAK,MAQzBC,QAAU,CACZC,WANe,sDAOfC,KANW,CACXC,SAAUN,UACVH,UAAWA,0BAORU,KAAK,CAACJ,UAAU,GAClBK,MAAK,SAAUC,OACdV,WAAaU,MAAK,aAEnBC,KAAKC,aAAaC,kCAGRC,OAAO,CAClBC,KAAMC,uBAAaC,MAAMC,YACzBC,MAAO,iBACPC,wbAOCC,MAAK,SAAUC,OAChBA,MAAMC,kBAAkB,gBAExBD,MAAME,2BACJ,iBAAiBC,OAEGC,SAASC,eAAe,cACxCC,cAAgBF,SAASC,eAAe,UAC1CE,WAAaH,SAASC,eAAe,YACzCE,WAAWC,IAAM9B,eACb+B,OAAS,uBAIX,iBAAiBhC,GAAG,SAAS,WAU7BiC,aAAY,eAELD,OAAQ,KACPE,QAAUL,cAAcM,WAAW,MACvCD,QAAQE,UAAU,EAAG,EAAGN,WAAWO,MAAOP,WAAWQ,QACrDJ,QAAQK,UACNT,WACA,EACA,EACAA,WAAWO,MACXP,WAAWQ,QAEbN,OAASH,cAAcW,UAAU,iBAG/BC,MAAQC,OAAOC,OASftC,QAAU,CACZC,WANA,2DAOAC,KANW,CACXuB,WAAYE,OACZY,cAAeH,sBAOZhC,KAAK,CAACJ,UAAU,GAClBK,MAAK,SAAUC,UACDA,MAAK,YAEJ,GAAK,KAQbN,SAAU,CACZC,WANA,sDAOAC,KANW,CACXC,SAAUN,UACVH,UAAWA,0BAORU,KAAK,CAACJ,WAAU,GAClBK,MAAK,WACJmC,OAAOC,SAASC,MAAO,mBAAED,UAAU1C,KAAK,WAEzCQ,KAAKC,aAAaC,eAIxBF,MAAK,SAAUoC,KACdH,OAAOI,QAAQC,IAAIF,UAGtB,4BAEH,gBAAgBhD,GAAG,SAAS,WAC5B0C,OAAOS,OACPN,OAAOC,SAASC,MAAO,mBAAED,UAAU1C,KAAK"}