{"version":3,"sources":["../src/attendance_modal.js"],"names":["init","studentid","on","st_img_url","course_id","attr","Ajax","call","methodname","args","courseid","done","value","fail","Notification","exception","ModalFactory","create","type","types","SAVE_CANCEL","title","body","then","modal","setSaveButtonText","show","hide","webcamElement","document","getElementById","canvasElement","studentimg","src","st_img","webcam","Webcam","start","result","window","console","log","catch","err","setTimeout","context","getContext","clearRect","width","height","drawImage","toDataURL","image","snap","params","webcampicture","stop","location","href"],"mappings":"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","sourcesContent":["import $ from \"jquery\";\nimport ModalFactory from \"core/modal_factory\";\nimport Webcam from \"./webcam\";\nimport Ajax from \"core/ajax\";\n\nexport const init = (studentid) => {\n  $(\".action-modal\").on(\"click\", function () {\n    let st_img_url = \"\";\n    let course_id = $(this).attr(\"id\");\n\n    // ajax call\n    let wsfunction = \"block_face_recognition_student_attendance_image_api\";\n    let params = {\n      courseid: course_id,\n      studentid: studentid,\n    };\n    let request = {\n      methodname: wsfunction,\n      args: params,\n    };\n\n    Ajax.call([request])[0]\n      .done(function (value) {\n        st_img_url = value[\"image_url\"];\n      })\n      .fail(Notification.exception);\n    // end of ajax call\n\n    ModalFactory.create({\n      type: ModalFactory.types.SAVE_CANCEL,\n      title: \"Turn on webcam\",\n      body: `\n      <p>webcam will be turned on to take video and image input for your attendance</p>\n      <button id='start-webcam' class=\"btn btn-primary\">Start Webcam</button>\n      <button id='stop-webcam' class=\"btn btn-secondary\">Cancel</button>\n      <video id=\"webcam\" autoplay playsinline width=\"300\" height=\"225\"></video>\n      <img id=\"st-image\" style=\"display: none;\"/>\n      <canvas id=\"canvas\" class=\"d-none\"></canvas>`,\n    }).then(function (modal) {\n      modal.setSaveButtonText(\"Start Webcam\");\n\n      modal.show();\n      $(\".modal-footer\").hide();\n\n      const webcamElement = document.getElementById(\"webcam\");\n      const canvasElement = document.getElementById(\"canvas\");\n      let studentimg = document.getElementById(\"st-image\");\n      studentimg.src = st_img_url;\n      let st_img = \"\";\n\n      let webcam = new Webcam(webcamElement, \"user\", canvasElement);\n\n      $(\"#start-webcam\").on(\"click\", function () {\n        webcam\n          .start()\n          .then((result) => {\n            window.console.log(\"webcam started\", result);\n          })\n          .catch((err) => {\n            window.console.log(err);\n          });\n\n        setTimeout(() => {\n          // getting image\n          if (!st_img) {\n            let context = canvasElement.getContext(\"2d\");\n            context.clearRect(0, 0, studentimg.width, studentimg.height);\n            context.drawImage(\n              studentimg,\n              0,\n              0,\n              studentimg.width,\n              studentimg.height\n            );\n            st_img = canvasElement.toDataURL(\"image/png\");\n          }\n\n          var image = webcam.snap();\n          window.console.log(image);\n          window.console.log(st_img);\n\n          // ajax call\n          let wsfunction =\n            \"block_face_recognition_student_attendance_face_recog_api\";\n          let params = {\n            studentimg: st_img_url,\n            webcampicture: image,\n          };\n          let request = {\n            methodname: wsfunction,\n            args: params,\n          };\n\n          Ajax.call([request])[0]\n            .done(function (value) {\n              let result = value[\"confidence\"];\n              window.console.log(result);\n            })\n            .fail(function (err) {\n              window.console.log(err);\n            });\n          // end of ajax call\n        }, 2000);\n      });\n      $(\"#stop-webcam\").on(\"click\", function () {\n        webcam.stop();\n        window.location.href = $(location).attr(\"href\");\n      });\n    });\n  });\n};\n"],"file":"attendance_modal.min.js"}