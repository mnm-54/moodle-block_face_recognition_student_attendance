{"version":3,"sources":["../src/attendance_modal.js"],"names":["init","studentid","window","console","log","on","st_img_url","course_id","attr","Ajax","call","methodname","args","courseid","done","value","fail","Notification","exception","ModalFactory","create","type","types","SAVE_CANCEL","title","body","then","modal","setSaveButtonText","show","hide","webcamElement","document","getElementById","canvasElement","studentimg","src","context","getContext","clearRect","width","height","drawImage","st_img","toDataURL","webcam","Webcam","start","result","catch","err","setInterval","snap","stop","location","href"],"mappings":"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","sourcesContent":["import $ from \"jquery\";\nimport ModalFactory from \"core/modal_factory\";\nimport Webcam from \"./webcam\";\nimport Ajax from \"core/ajax\";\n\nexport const init = (studentid) => {\n  window.console.log(\"we have been started\");\n  window.console.log(studentid);\n  $(\".action-modal\").on(\"click\", function () {\n    let st_img_url = \"\";\n    let course_id = $(this).attr(\"id\");\n    window.console.log(course_id);\n\n    // ajax call\n    let wsfunction = \"block_face_recognition_student_attendance_image_api\";\n    let params = {\n      courseid: course_id,\n      studentid: studentid,\n    };\n    let request = {\n      methodname: wsfunction,\n      args: params,\n    };\n\n    Ajax.call([request])[0]\n      .done(function (value) {\n        st_img_url = value[\"image_url\"];\n      })\n      .fail(Notification.exception);\n    // end of ajax call\n\n    ModalFactory.create({\n      type: ModalFactory.types.SAVE_CANCEL,\n      title: \"Turn on webcam\",\n      body: `\n      <p>webcam will be turned on to take video and image input for your attendance</p>\n      <button id='start-webcam' class=\"btn btn-primary\">Start Webcam</button>\n      <button id='stop-webcam' class=\"btn btn-secondary\">Cancel</button>\n      <video id=\"webcam\" autoplay playsinline width=\"640\" height=\"480\"></video>\n      <img id=\"st-image\" style=\"display: none;\"/>\n      <canvas id=\"canvas\" class=\"d-none\"></canvas>`,\n    }).then(function (modal) {\n      modal.setSaveButtonText(\"Start Webcam\");\n\n      modal.show();\n      $(\".modal-footer\").hide();\n\n      const webcamElement = document.getElementById(\"webcam\");\n      const canvasElement = document.getElementById(\"canvas\");\n      let studentimg = document.getElementById(\"st-image\");\n      studentimg.src = st_img_url;\n      // getting image\n      let context = canvasElement.getContext(\"2d\");\n      context.clearRect(0, 0, studentimg.width, studentimg.height);\n      context.drawImage(studentimg, 0, 0, studentimg.width, studentimg.height);\n      let st_img = canvasElement.toDataURL(\"image/png\");\n      window.console.log(st_img);\n\n      let webcam = new Webcam(webcamElement, \"user\", canvasElement);\n\n      $(\"#start-webcam\").on(\"click\", function () {\n        webcam\n          .start()\n          .then((result) => {\n            window.console.log(\"webcam started\", result);\n          })\n          .catch((err) => {\n            window.console.log(err);\n          });\n\n        setInterval(() => {\n          var image = webcam.snap();\n          // fetch(\"http://13.229.125.223:5000/verify\")\n          //   .then((res) => {\n          //     if (res.ok) {\n          //       window.console.log(\"success\");\n          //     } else {\n          //       window.console.log(\"failure in connection\");\n          //     }\n          //     res.json();\n          //   })\n          //   .then((data) => {\n          //     window.console.log(data);\n          //   });\n        }, 1000);\n      });\n      $(\"#stop-webcam\").on(\"click\", function () {\n        webcam.stop();\n        window.location.href = $(location).attr(\"href\");\n      });\n    });\n  });\n};\n"],"file":"attendance_modal.min.js"}